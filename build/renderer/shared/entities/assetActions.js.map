{"version":3,"sources":["../../../../app/renderer/shared/entities/assetActions.js"],"names":["ASSET_LOADED","ASSET_REMOVED","ASSETS_LOADED","ASSETS_LOAD","ASSETS_INVALIDATE","request","type","receiveSingle","item","removeSingle","receiveAll","items","getTagData","assetTags","data","forEach","assetTag","index","id","getFolderData","pathname","folderId","folder","invalidateAssetsAction","loadAssetAction","_id","dispatch","url","then","response","loadAssetsAction","getState","assets","router","location","isFetching","tag","length","resolve","refreshAssetsAction","setAssetsAction","removeAssetAction"],"mappings":"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","file":"assetActions.js","sourcesContent":["import { getData } from '../utils/EntityHelper'\nimport { getRequest } from '../utils/ApiRepository'\nimport { getTagId, getFolderId, isTagRoute, isFolderRoute } from '../utils/LocationHelper'\n\nexport const ASSET_LOADED = 'ASSET_LOADED'\nexport const ASSET_REMOVED = 'ASSET_REMOVED'\nexport const ASSETS_LOADED = 'ASSETS_LOADED'\nexport const ASSETS_LOAD = 'ASSETS_LOAD'\nexport const ASSETS_INVALIDATE = 'ASSETS_INVALIDATE'\n\nconst request = () => ({ type: ASSETS_LOAD })\nconst receiveSingle = item => ({ type: ASSET_LOADED, item })\nconst removeSingle = item => ({ type: ASSET_REMOVED, item })\nconst receiveAll = items => ({ type: ASSETS_LOADED, items })\n\nconst getTagData = (assetTags) => {\n  const data = {}\n  assetTags.forEach((assetTag, index) => {\n    data[`assetTags[${index}]`] = assetTag.id\n  })\n\n  return data\n}\n\nconst getFolderData = (pathname) => {\n  const folderId = getFolderId(pathname)\n  return folderId !== 'bucket' ? { folder: folderId } : { 'folder[exists]': false }\n}\n\nexport const invalidateAssetsAction = () => ({\n  type: ASSETS_INVALIDATE\n})\n\nexport const loadAssetAction = _id => (dispatch) => {\n  const { url } = getData('assets', _id)\n  return getRequest(url).then(response => dispatch(receiveSingle(response)))\n}\n\nexport const loadAssetsAction = () => (dispatch, getState) => {\n  const { assets, router } = getState()\n  const pathname = router.location.pathname\n\n  if (assets.items === null && !assets.isFetching) {\n    dispatch(request())\n\n    if (isTagRoute(pathname) && getTagId(pathname) !== 'tags') {\n      getRequest('asset_tags', { tag: getTagId(pathname) }).then((assetTags) => {\n        const data = getTagData(assetTags)\n        if (Object.keys(data).length) {\n          return getRequest('assets', data).then((response) => {\n            dispatch(receiveAll(response))\n          })\n        }\n        dispatch(receiveAll([]))\n      })\n    } else if (isFolderRoute(pathname)) {\n      return getRequest('assets', getFolderData(pathname)).then((response) => {\n        dispatch(receiveAll(response))\n      })\n    } else {\n      dispatch(receiveAll([]))\n    }\n  }\n\n  return Promise.resolve()\n}\n\nexport const refreshAssetsAction = () => (dispatch, getState) => {\n  const { router } = getState()\n  const pathname = router.location.pathname\n\n  if (isTagRoute(pathname) && getTagId(pathname) !== 'tags') {\n    getRequest('asset_tags', { tag: getTagId(pathname) }).then((assetTags) => {\n      const data = getTagData(assetTags)\n      if (Object.keys(data).length) {\n        return getRequest('assets', data).then((response) => {\n          dispatch(receiveAll(response))\n        })\n      }\n      dispatch(receiveAll([]))\n    })\n  } else if (isFolderRoute(pathname)) {\n    return getRequest('assets', getFolderData(pathname)).then((response) => {\n      dispatch(receiveAll(response))\n    })\n  } else {\n    dispatch(receiveAll([]))\n    return Promise.resolve()\n  }\n}\n\nexport const setAssetsAction = data => dispatch => dispatch(receiveAll(data))\nexport const removeAssetAction = id => dispatch => dispatch(removeSingle({ id }))\n"]}