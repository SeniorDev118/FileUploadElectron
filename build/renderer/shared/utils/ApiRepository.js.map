{"version":3,"sources":["../../../../app/renderer/shared/utils/ApiRepository.js"],"names":["getData","response","status","localStorage","removeItem","window","location","reload","json","formatAPIError","data","str","Object","forEach","key","getRequestBody","FormData","buildHeaders","headers","Accept","getItem","Authorization","buildURL","url","params","parts","push","serializedParams","join","checkInternalError","Error","getRequest","parameters","fetch","global","API_URL","method","then","catch","error","console","log","message","postRequest","resource","body","includes","deleteRequest","id","putRequest","failed"],"mappings":"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","file":"ApiRepository.js","sourcesContent":["/* global API_URL */\n\nconst getData = (response) => {\n  if (response.status === 401) {\n    localStorage.removeItem('token')\n    window.location.reload()\n  }\n\n  return response.json()\n}\n\nconst formatAPIError = (data) => {\n  let str = ''\n\n  if (data instanceof Object) {\n    Object.keys(data).forEach((key) => {\n      str += `\\n${key}: ${data[key]}`\n    })\n  } else {\n    str = `\\n${data}`\n  }\n\n  return str\n}\n\nconst getRequestBody = (data) => {\n  if (data instanceof FormData || typeof data === 'string') {\n    return data\n  }\n  return JSON.stringify(data)\n}\n\nconst buildHeaders = (data) => {\n  let headers = {\n    Accept: 'application/json'\n  }\n\n  if (localStorage.getItem('token')) {\n    headers = {\n      ...headers,\n      Authorization: `Bearer ${localStorage.getItem('token')}`\n    }\n  }\n\n  if (data && data instanceof FormData) {\n    return headers\n  }\n\n  return {\n    ...headers,\n    'Content-Type': 'application/json'\n  }\n}\n\nconst buildURL = (url, params) => {\n  if (!params) {\n    return url\n  }\n\n  const parts = []\n  Object.keys(params).forEach((key) => {\n    parts.push(`${key}=${params[key]}`)\n  })\n\n  const serializedParams = parts.join('&')\n\n  if (serializedParams) {\n    url += `?${serializedParams}`\n  }\n\n  return url\n}\n\nconst checkInternalError = (response) => {\n  if (response.status >= 500) {\n    throw new Error('There was an internal Error')\n  }\n\n  return response\n}\n\nexport const getRequest = (url, parameters = null) =>\n  fetch(buildURL(global.API_URL + `/${url}.json`, parameters), {\n    method: 'GET',\n    headers: buildHeaders()\n  })\n    .then(checkInternalError)\n    .then(response => getData(response))\n    .catch((error) => {\n      console.log(`Error fetching ${url}`, error.message)\n      throw error\n    })\n\nexport const postRequest = (resource, data) =>\n  fetch(global.API_URL + `/${resource}`, {\n    method: 'POST',\n    headers: buildHeaders(data),\n    body: getRequestBody(data)\n  })\n    .then(checkInternalError)\n    .then((response) => {\n      if ([201, 400, 401].includes(response.status)) {\n        return getData(response)\n      }\n\n      throw new Error(formatAPIError(response))\n    })\n    .catch((error) => {\n      console.log(`Error creating ${resource}`, error.message)\n      throw error\n    })\n\nexport const deleteRequest = (resource, id) =>\n  fetch(global.API_URL + `/${resource}/${id}`, {\n    method: 'DELETE',\n    headers: buildHeaders()\n  })\n    .then(checkInternalError)\n    .then((response) => {\n      if (response.status === 204) {\n        return { id }\n      }\n\n      throw new Error(formatAPIError(response))\n    })\n    .catch((error) => {\n      console.log(`Error deleting ${resource}`, error.message)\n      throw error\n    })\n\nexport const putRequest = (resource, id, data) => {\n  let failed = false\n  return fetch(global.API_URL + `/${resource}/${id}`, {\n    method: 'PUT',\n    headers: buildHeaders(data),\n    body: getRequestBody(data)\n  })\n    .then(checkInternalError)\n    .then((response) => {\n      if (response.status !== 200) {\n        failed = true\n      }\n      return getData(response)\n    })\n    .then((json) => {\n      if (failed) {\n        throw new Error(formatAPIError(json))\n      }\n      return json\n    })\n    .catch((error) => {\n      console.log(`Error editing ${resource} ${id}`, error.message)\n      throw error\n    })\n}\n"]}